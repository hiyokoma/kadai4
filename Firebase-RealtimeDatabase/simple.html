<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="utf-8">
    <title>Firebase_version9_RealtimeDB(G'sACADEMYåˆå­¦è€…ç”¨ã‚µãƒ³ãƒ—ãƒ«)</title>

    <style>
        #output {
            background: pink;
            height: 300px;
            overflow: scroll;
        }

        .msg:nth-child(odd) {
            width: 40%;
            background: gainsboro;
            margin-left: auto;
            border-radius: 10px;
            padding: 10px;
            box-sizing: border-box;
        }

        .msg:nth-child(even) {
            background: green;
            width: 40%;
            padding: 10px;
            border-radius: 10px;
        }
    </style>
</head>

<body>

    <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->

    <div>
        <div>
            <textarea id="text" cols="30" rows="10"></textarea>
            <button id="send">é€ä¿¡</button>
        </div>
        <button id="st"><img src="23252703.png" width="150px"></button>
        <div id="output"></div>
    </div>
    <!--/ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->



    <!-- JQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- JQuery -->

    <!--** ä»¥ä¸‹Firebase **-->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-app.js";

        // è²¼ã‚Šä»˜ã‘ã‚‹å ´æ‰€
        import { getDatabase, ref, push, set, onChildAdded, remove, onChildRemoved } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-database.js";
        // 


        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBKWAUaXqgYXXyCWGzXMfKfdosoDlfPun8",
             authDomain: "dev245-68c5a.firebaseapp.com",
            databaseURL: "https://dev245-68c5a-default-rtdb.firebaseio.com",
             projectId: "dev245-68c5a",
            storageBucket: "dev245-68c5a.appspot.com",
            messagingSenderId: "732331179377",
             appId: "1:732331179377:web:64435a7493fc4030c0cad0"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);

        // ã“ã®è¾ºã‚Šã«æ›¸ã„ã¦ã„ãã¾ã™


        const db = getDatabase(app);
        const dbRef = ref(db, 'dev245');

        // é€ä¿¡å‡¦ç†ã‚’è¨˜è¿°
        $('#send').on('click', function () {

 
            const text = $('#text').val();

            // firebaseã«é€ã‚‹æº–å‚™ã‚’ã—ã¦ã„ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ğŸ¤—
            const newPostRef = push(dbRef) //ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã§ãã‚‹æº–å‚™
            set(newPostRef, text); // firebaseã®ç™»éŒ²ã§ãã‚‹å ´æ‰€ã«ä¿å­˜ã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ğŸ¤—

            $('#text').val("");

            // sendé€ä¿¡ã‚¤ãƒ™ãƒ³ãƒˆ ã“ã®ä¸‹æ¶ˆã•ãªã„
        });

         $('#st').on('click', function () {

            const st = "23252703.png";

            const newPostRef = push(dbRef) //ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã§ãã‚‹æº–å‚™
            set(newPostRef, st); // firebaseã®ç™»éŒ²ã§ãã‚‹å ´æ‰€ã«ä¿å­˜ã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ğŸ¤—

            $('#st').val("");


            // sendé€ä¿¡ã‚¤ãƒ™ãƒ³ãƒˆ ã“ã®ä¸‹æ¶ˆã•ãªã„
        });


        $("#text").on('keydown',function (e){

            

        });

    //å—ä¿¡å‡¦ç†

   // å—ä¿¡å‡¦ç†ã‚’è¨˜è¿°
   onChildAdded(dbRef, function (data) {
            // ã“ã“ã‹ã‚‰ãŒå—ä¿¡å‡¦ç†ãŒå§‹ã¾ã‚Šã¾ã™

            // ç™»éŒ²ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã™ğŸ¤—
            const msg = data.val();
            console.log(msg, 'å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã®å¡Š')
            const key = data.key;
            console.log(key, 'ãƒ‡ãƒ¼ã‚¿ã®å¡Šã«ã‚¢ã‚¯ã‚»ã‚¹')

            var h ="";
            var e ="";

            // es6ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒªãƒ†ãƒ©ãƒ«

            if (msg.indexOf('png') != -1) {
                  console.log('æ–‡å­—åˆ—ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚');
                  var h = `
                <div class="msg">
                    <img src="${msg}" width="150px">
                </div>    
            `;  
            $("#output").append(h);
                        console.log(msg, 'å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã®å¡Š')

                } else {
                    console.log(msg);

                let e = `
                <div class="msg">
                    <p>${msg}</p>
                </div>    
            `;
            $("#output").append(e);

        }
            // htmlã«åŸ‹ã‚è¾¼ã¿ã¾ã—ã‚‡ã†ğŸ¤—
            // append();ã¨ã„ã†jqueryã®ãŠã¾ã˜ãªã„ã‚’ä½¿ã„ã¾ã™
            const output = document.getElementById('output');
            output.scrollTo(0, output.scrollHeight);

        })
    
  </script>









</body>
</html>
































